CREATE TABLE sales (
    sale_id SERIAL PRIMARY KEY,
    customer_id INTEGER,
    model VARCHAR(50),
    serial_number VARCHAR(100),
    year INTEGER,
    sale_date DATE,
    sale_price NUMERIC(10,2),
    warranty_months INTEGER,
    payment_terms VARCHAR(50),
    delivery_date DATE,
    salesperson VARCHAR(100)
);


CREATE TABLE failures (
    failure_id SERIAL PRIMARY KEY,
    equipment_id INTEGER, 
    failure_date DATE,
    failure_category VARCHAR(50),
    severity VARCHAR(40),
    description VARCHAR(100)
);

CREATE TABLE warranty_cases (
    warranty_id SERIAL PRIMARY KEY,
    equipment_id INTEGER, 
    customer_id INTEGER, 
    case_open_date DATE,
    case_close_date DATE,
    issue_description VARCHAR(100),
    approval_status VARCHAR(40),
    amount_claimed NUMERIC(10,2),
    amount_approved NUMERIC(10,2)
);

CREATE TABLE parts (
    part_id SERIAL PRIMARY KEY,
    part_number VARCHAR(50),
    description VARCHAR(70),
    category VARCHAR(50),
    unit_cost NUMERIC(10,2),
    supplier VARCHAR(50),
    stock_qty INTEGER,
    min_stock INTEGER
);


CREATE TABLE service_order (
    service_id SERIAL PRIMARY KEY,
    equipment_id INTEGER, 
    customer_id INTEGER, 
    service_type VARCHAR(40),
    start_date DATE,
    end_date DATE,
    reported_issue VARCHAR(50),
    root_cause VARCHAR(50),
    technician VARCHAR(40),
    status VARCHAR(40)
);

CREATE TABLE parts_usage (
    part_usage_id SERIAL PRIMARY KEY,
    service_id INTEGER, 
    part_id INTEGER, 
    quantity INTEGER,
    unit_price NUMERIC(10,2),
    total_price NUMERIC(10,2),
    warehouse_location VARCHAR(10)
);

CREATE TABLE parts_sales (
    sale_line_id SERIAL PRIMARY KEY,
    sale_date DATE,
    customer_id INTEGER, 
    part_id INTEGER, 
    quantity INTEGER,
    unit_price NUMERIC(10,2),
    total_price NUMERIC(10,2),
    sale_type VARCHAR(20),
    service_id INTEGER, 
    invoice_number VARCHAR(30)
);

CREATE TABLE equipment (
    equipment_id SERIAL PRIMARY KEY,
    serial_number VARCHAR(50),
    model VARCHAR(50),
    year INTEGER,
    customer_id INTEGER,
    current_status VARCHAR(50),
    hours_worked INTEGER,
    location_department VARCHAR(50),
    location_city VARCHAR(50)
);

CREATE TABLE customer (
    customer_id SERIAL PRIMARY KEY,
    customer_number VARCHAR(40),
    customer_name VARCHAR(50),
    creation_date DATE,
    department_city VARCHAR(50),
    address VARCHAR(50),
    phone VARCHAR(20),
    email VARCHAR(50),
    status VARCHAR(20)
);



-- Agregar nueva con CASCADE
--failures
ALTER TABLE failures ADD CONSTRAINT equipment_id_failures_fkey
FOREIGN KEY (equipment_id) REFERENCES equipment(equipment_id) 
ON DELETE CASCADE ON UPDATE CASCADE;


--parts_sales
ALTER TABLE parts_sales ADD CONSTRAINT customer_id_parts_sales_fkey
FOREIGN KEY (customer_id) REFERENCES customer(customer_id) 
ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE parts_sales ADD CONSTRAINT part_id_fkey
FOREIGN KEY (part_id) REFERENCES parts(part_id) 
ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE parts_sales ADD CONSTRAINT service_id_fkey
FOREIGN KEY (service_id) REFERENCES service_order(service_id) 
ON DELETE CASCADE ON UPDATE CASCADE;

-- parts_usage

ALTER TABLE parts_usage ADD CONSTRAINT service_id_fkey
FOREIGN KEY (service_id) REFERENCES service_order(service_id) 
ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE parts_usage ADD CONSTRAINT part_id_fkey
FOREIGN KEY (part_id) REFERENCES parts(part_id) 
ON DELETE CASCADE ON UPDATE CASCADE;

--service_order


ALTER TABLE service_order ADD CONSTRAINT equipment_id_service_ord_fkey
FOREIGN KEY (equipment_id) REFERENCES equipment(equipment_id) 
ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE service_order ADD CONSTRAINT customer_id_fkey
FOREIGN KEY (customer_id) REFERENCES customer(customer_id) 
ON DELETE CASCADE ON UPDATE CASCADE;

--warranty_cases

ALTER TABLE warranty_cases ADD CONSTRAINT equipment_id_fkey
FOREIGN KEY (equipment_id) REFERENCES equipment(equipment_id) 
ON DELETE CASCADE ON UPDATE CASCADE;

ALTER TABLE warranty_cases ADD CONSTRAINT customer_id_fkey
FOREIGN KEY (customer_id) REFERENCES customer(customer_id) 
ON DELETE CASCADE ON UPDATE CASCADE;


--failures
ALTER TABLE failures ADD CONSTRAINT equipment_id_fkey
FOREIGN KEY (equipment_id) REFERENCES equipment(equipment_id) 
ON DELETE CASCADE ON UPDATE CASCADE;


--sales

ALTER TABLE sales ADD CONSTRAINT customer_id_fkey
FOREIGN KEY (customer_id) REFERENCES customer(customer_id) 
ON DELETE CASCADE ON UPDATE CASCADE;

--equipment

ALTER TABLE equipment ADD CONSTRAINT customer_id_fkey
FOREIGN KEY (customer_id) REFERENCES customer(customer_id) 
ON DELETE CASCADE ON UPDATE CASCADE;
-- eliminar columna department_city separar en department 
--y city
ALTER TABLE customer DROP COLUMN department_city ;

ALTER TABLE customer 
ADD COLUMN department VARCHAR(50),
ADD COLUMN city VARCHAR(50)
